# 県対抗歩数バトル - API仕様書

## 概要

県対抗で平均歩数を競うアプリのバックエンドAPI。
ユーザー認証なし、アプリから送られるUUIDで識別。

---

## ベースURL

```
http://localhost:3000
```

---

## データモデル

### User

| フィールド | 型 | 説明 |
|-----------|-----|------|
| uuid | String | ユーザー識別子（主キー） |
| prefectureId | Int | 県ID（1〜47） |
| steps | Int | 歩数 |
| updatedAt | DateTime | 更新日時 |

---

## エンドポイント一覧

| メソッド | エンドポイント | 概要 |
|---------|---------------|------|
| POST | /steps | 歩数登録 |
| GET | /characters | キャラ一覧取得 |
| GET | /characters/:prefectureId | キャラ単体取得 |

---

## API詳細

### POST /steps

歩数を登録する。UUIDが存在しなければ新規作成、存在すれば更新。

**リクエスト**

```json
{
  "uuid": "550e8400-e29b-41d4-a716-446655440000",
  "prefectureId": 13,
  "steps": 8500
}
```

| フィールド | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| uuid | String | ✓ | ユーザー識別子（UUID形式） |
| prefectureId | Int | ✓ | 県ID（1〜47） |
| steps | Int | ✓ | 歩数（0以上） |

**レスポンス**

```json
{
  "success": true
}
```

**エラー**

```json
{
  "error": "Invalid prefectureId. Must be between 1 and 47"
}
```

---

### GET /characters

全県のキャラ状態一覧を取得する。

**レスポンス**

```json
[
  {
    "prefectureId": 13,
    "averageSteps": 8500,
    "status": 2
  },
  {
    "prefectureId": 27,
    "averageSteps": 6200,
    "status": 1
  },
  {
    "prefectureId": 1,
    "averageSteps": 3000,
    "status": 0
  }
]
```

| フィールド | 型 | 説明 |
|-----------|-----|------|
| prefectureId | Int | 県ID（1〜47） |
| averageSteps | Int | 平均歩数（小数点以下切り捨て） |
| status | Int | ステータス（0: 下位, 1: 中間, 2: 上位30%） |

---

### GET /characters/:prefectureId

指定した県のキャラ状態を取得する。

**パスパラメータ**

- `prefectureId`: 県ID（1〜47）

**レスポンス**

```json
{
  "prefectureId": 13,
  "averageSteps": 8500,
  "status": 2
}
```

| フィールド | 型 | 説明 |
|-----------|-----|------|
| prefectureId | Int | 県ID（1〜47） |
| averageSteps | Int | 平均歩数（小数点以下切り捨て） |
| status | Int | ステータス（0: 下位, 1: 中間, 2: 上位30%） |

**エラー**

```json
{
  "error": "Invalid prefectureId. Must be between 1 and 47"
}
```

---

## ステータス判定ロジック

平均歩数が1歩以上ある県を対象に、順位に応じてステータスを決定。

| 順位 | ステータス |
|------|-----------|
| 上位30% | 2 |
| 中間 | 1 |
| 下位 | 0 |

※ 平均歩数0の県は対象外（ステータス0）

**判定アルゴリズム**

1. 全県の平均歩数を計算
2. 平均歩数が1歩以上の県を抽出
3. 平均歩数で降順ソート
4. 上位30%をステータス2、残りのうち上位をステータス1、下位をステータス0に設定
5. 平均歩数0の県はステータス0

---

## 県ID一覧

| ID | 県名 | ID | 県名 | ID | 県名 |
|----|------|----|----- |----|------|
| 1 | 北海道 | 17 | 石川県 | 33 | 岡山県 |
| 2 | 青森県 | 18 | 福井県 | 34 | 広島県 |
| 3 | 岩手県 | 19 | 山梨県 | 35 | 山口県 |
| 4 | 宮城県 | 20 | 長野県 | 36 | 徳島県 |
| 5 | 秋田県 | 21 | 岐阜県 | 37 | 香川県 |
| 6 | 山形県 | 22 | 静岡県 | 38 | 愛媛県 |
| 7 | 福島県 | 23 | 愛知県 | 39 | 高知県 |
| 8 | 茨城県 | 24 | 三重県 | 40 | 福岡県 |
| 9 | 栃木県 | 25 | 滋賀県 | 41 | 佐賀県 |
| 10 | 群馬県 | 26 | 京都府 | 42 | 長崎県 |
| 11 | 埼玉県 | 27 | 大阪府 | 43 | 熊本県 |
| 12 | 千葉県 | 28 | 兵庫県 | 44 | 大分県 |
| 13 | 東京都 | 29 | 奈良県 | 45 | 宮崎県 |
| 14 | 神奈川県 | 30 | 和歌山県 | 46 | 鹿児島県 |
| 15 | 新潟県 | 31 | 鳥取県 | 47 | 沖縄県 |
| 16 | 富山県 | 32 | 島根県 | | |

---

## パフォーマンス考慮事項

- アプリから毎秒ポーリング想定
- `/characters` エンドポイントはキャッシュ推奨（将来的にRedis等を検討）
- ステータス閾値（30%など）は環境変数で調整可能にする
